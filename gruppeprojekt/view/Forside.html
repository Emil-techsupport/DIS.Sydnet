<!DOCTYPE html>
<html lang="da">
<head>
  <link rel="stylesheet" href="/forside.css">
  <meta charset="UTF-8" />
  <title>Forsiden</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-top">
        <div class="logo-box">Understory</div>

        <nav>
          <div class="nav-section">
            <div class="nav-item">
              <span>Hjem</span>
            </div>
            <div class="nav-item">
              <span>Kalender</span>
            </div>
            <div class="nav-item active">
              <span>Oplevelser</span>
            </div>
            <div class="nav-item">
              <span>Salg</span>
            </div>
          </div>

          <div class="nav-item-group-title">Storefront</div>
          <div class="nav-section">
            <div class="nav-item">
              <span>Storefront</span>
            </div>
            <div class="nav-item">
              <span>Grow</span>
            </div>
          </div>
        </nav>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <div class="main-header">
        <h1 class="title">Oplevelser</h1>
        <!-- eneste interaktive element -->
        <button class="primary-btn" id="oplevelserknap">+ Oplevelse</button>
      </div>

      <div class="filters">
        <button class="filter-pill active">Live</button>
        <button class="filter-pill">Arkiveret</button>
      </div>

            <!-- Container til dynamiske events - bruger samme experience-card stil -->
      <div id="events-container">
        <button style="text-align: center; padding: 40px; color: #6b7280; cursor: pointer;" id="loading-message">
          Henter oplevelser...
        </button>
    </main>
  </div>

  <script>
    // Hent events fra API når siden loader
    async function loadEvents() {
      const container = document.getElementById('events-container');
      const loadingMessage = document.getElementById('loading-message');
      
      try {
        // Hent Anna's events (når Anna er logget ind)
        // Dynamisk endpoint - kan ændres til hvilken som helst vært
        const response = await fetch('/services/hostEvents?host=Anna');
        const hostDataClient = await response.json();
        console.log("************HostDataClient********");
        console.log(hostDataClient);
        //console.log("************HostDataClient.events********");
        //console.log(hostDataClient.data);
        
        if (hostDataClient.success && hostDataClient.data) {
          // Vis alle events fra alle værter
          displayEvents(hostDataClient.data);
        
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc2626;">Kunne ikke hente oplevelser: ' + (hostDataClient.error || 'Ukendt fejl') + '</div>';
        }
      } catch (error) {
        if (loadingMessage) loadingMessage.remove();
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc2626;">Der opstod en fejl ved hentning af data: ' + error.message + '</div>';
      }
    }

    // Vis events i UI - bruger samme experience-card struktur
    function displayEvents(hosts) {
      //console.log("*******Hosts********");
      //console.log(hosts);
      const container = document.getElementById('events-container');
      
        if (!hosts || hosts.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">Ingen oplevelser fundet</div>';
        return;
      }

      // Tøm container først
      container.innerHTML = '';


      console.log("******displayEvents Hosts*****");
      console.log(hosts);

      console.log("******displayEvents Events*****");
      console.log(hosts.events[0]);

      console.log("******displayEvents Event nummer 0*****");
      console.log(hosts.events[0][0]);


      let antalEvents = hosts.events[0].length

      console.log("Antal events i tal");
      console.log(antalEvents);

      // Loop gennem alle hosts
      for (let i = 0; i < antalEvents; i++) {
        const event = hosts.events[0][i];
        console.log("*******Host********");
        console.log(event);
        
        // Hent event data direkte
        const eventData = event
        console.log("*******Host.event********");
        console.log(eventData);

        console.log(eventData.titel);
        
        // Start med standard værdier
        let titel = 'Ingen titel angivet';
        let subtitle = 'Standardoplevelse';
        
        // Hvis vi har event data med en titel, brug den
        if (eventData && eventData.titel) {
          // Sæt titlen til event data titlen
          titel = eventData.titel;
          
          // Byg beskrivelsen op stykke for stykke
          let beskrivelseTekst = '';
          
          // Tilføj beskrivelse hvis den findes
          if (eventData.beskrivelse) {
            beskrivelseTekst = eventData.beskrivelse;
          }
          
          // Tilføj dato og tid hvis de findes
          if (eventData.dato && eventData.tid) {
            if (beskrivelseTekst) {
              beskrivelseTekst += ' • ';  // Tilføj separator hvis der allerede er tekst
            }
            beskrivelseTekst += `${eventData.dato} kl. ${eventData.tid}`;
          }
        
          // Brug den byggede beskrivelse, eller standard hvis den er tom
          subtitle = beskrivelseTekst || 'Standardoplevelse';
          
          } else {
            // Hvis vi ikke har event data, brug vært information i stedet
            titel = `${hosts.kategori || 'Oplevelse'} hos ${hosts.source}`;
            subtitle = `Lokation: ${hosts.lokation}`;
          }
        
        // Opret experience-card -
        const card = document.createElement('section');
        card.className = 'experience-card';
        card.dataset.id = hosts.id;
        card.style.cursor = "pointer";
        
        // Generer HTML 
        card.innerHTML = `
        <div class="experience-image">
          <div class="draft-badge">${eventData.kategori || 'Oplevelse'}</div>
        </div>
        <div class="experience-content">
          <div class="experience-title">${titel}</div>
          <div class="experience-subtitle">${subtitle}</div>
        </div>
        `;
      
        //console.log("*******check data Inden vi opretter eventlistner********");
        //console.log(eventData);
        //console.log(eventData.id);

        card.addEventListener("click", () => {
          //window.location.href = ("/oplevelser");

          console.log("*******Check event.id inden den bliver sendt videre til oplevelser.html********");
          console.log(eventData.id);

          let clickedEvent = eventData.id;
          window.location.href = `/oplevelser?event=${clickedEvent}`;
        });  

        container.appendChild(card);
      }
    }

  // Hent hosts når siden loader
  loadEvents();

  </script>
</body>
</html>