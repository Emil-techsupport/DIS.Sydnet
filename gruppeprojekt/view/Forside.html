<!DOCTYPE html>
<html lang="da">
<head>
  <link rel="stylesheet" href="/forside.css">
  <meta charset="UTF-8" />
  <title>Forsiden</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-top">
        <div class="logo-box">Understory</div>

        <nav>
          <div class="nav-section">
            <div class="nav-item">
              <span>Hjem</span>
            </div>
            <div class="nav-item">
              <span>Kalender</span>
            </div>
            <div class="nav-item active">
              <span>Oplevelser</span>
            </div>
            <div class="nav-item">
              <span>Salg</span>
            </div>
          </div>

          <div class="nav-item-group-title">Storefront</div>
          <div class="nav-section">
            <div class="nav-item">
              <span>Storefront</span>
            </div>
            <div class="nav-item">
              <span>Grow</span>
            </div>
          </div>
        </nav>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <div class="main-header">
        <h1 class="title">Oplevelser</h1>
        <!-- eneste interaktive element -->
        <button class="primary-btn" id="oplevelserknap">+ Oplevelse</button>
      </div>

      <div class="filters">
        <button class="filter-pill active">Live</button>
        <button class="filter-pill">Arkiveret</button>
      </div>

            <!-- Container til dynamiske events - bruger samme experience-card stil -->
      <div id="events-container">
        <button style="text-align: center; padding: 40px; color: #6b7280; cursor: pointer;" id="loading-message">
          Henter oplevelser...
        </button>
    </main>
  </div>

  <script>
    // Hent events fra API når siden loader
    async function loadEvents() {
      const container = document.getElementById('events-container');
      const loadingMessage = document.getElementById('loading-message');
      
      try {
        // Hent data fra API
        const response = await fetch('/services/events');
        const result = await response.json();
        
        
        if (result.success && result.data) {
          // Vis alle events fra alle værter
          displayEvents(result.data);
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc2626;">Kunne ikke hente oplevelser: ' + (result.error || 'Ukendt fejl') + '</div>';
        }
      } catch (error) {
        if (loadingMessage) loadingMessage.remove();
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc2626;">Der opstod en fejl ved hentning af data: ' + error.message + '</div>';
      }
    }

    // Vis events i UI 
    function displayEvents(events) {
      const container = document.getElementById('events-container');
      
        if (!events || events.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">Ingen oplevelser fundet</div>';
        return;
      }

      // Tøm container først
      container.innerHTML = '';

      // Loop gennem alle events
      for (let i = 0; i < events.length; i++) {
        const event = events[i];
        
        // Hent event data direkte
        const eventData = event.data;
        
        // Start med standard værdier
        let title = 'Ingen titel angivet';
        let subtitle = 'Standardoplevelse';
        
        // Hvis vi har event data med en titel, brug den
        if (eventData && eventData.title) {
          // Sæt titlen til event data titlen
          title = eventData.title;
          
          // Byg beskrivelsen op stykke for stykke
          let beskrivelseTekst = '';
          
          // Tilføj beskrivelse hvis den findes
          if (eventData.beskrivelse) {
            beskrivelseTekst = eventData.beskrivelse;
          }
          
          // Tilføj dato og tid hvis de findes
          if (eventData.dato && eventData.tid) {
            if (beskrivelseTekst) {
              beskrivelseTekst += ' • ';  // Tilføj separator hvis der allerede er tekst
            }
            beskrivelseTekst += `${eventData.dato} kl. ${eventData.tid}`;
          }
          
        
          // Brug den byggede beskrivelse, eller standard hvis den er tom
          subtitle = beskrivelseTekst || 'Standardoplevelse';
          
        } else {
          // Hvis vi ikke har event data, brug vært information i stedet
          title = `${event.kategori || 'Oplevelse'} hos ${event.source}`;
          subtitle = `Lokation: ${event.lokation}`;
        }
        
        // Opret experience-card -
        const card = document.createElement('section');
        card.className = 'experience-card';
        card.style.cursor = "pointer";
        
        // Generer HTML 
        card.innerHTML = `
        <div class="experience-image">
          <div class="draft-badge">${event.kategori || 'Oplevelse'}</div>
        </div>
        <div class="experience-content">
          <div class="experience-title">${title}</div>
          <div class="experience-subtitle">${subtitle}</div>
        </div>
      `;

      card.addEventListener("click", () => {
        window.location.href = "/oplevelser";
      });  

        container.appendChild(card);
      }
    }

  // Hent events når siden loader
  loadEvents();

  </script>
</body>
</html>